---

  - lineinfile: dest=/etc/hosts regexp='^{{ docker_registry_ip | regex_replace('^(.*)\.(.*)\.(.*)\.(.*)', '\\1\.\\2\.\\3\.\\4') }}' line='{{docker_registry_ip}} {{docker_registry_host}}' owner=root group=root mode=0644

  - include: certificate.yml
    when: docker_registry_with_ssl|bool

  - name: test login to private docker registry
    shell: docker login --username={{item.name}} --password={{item.password}} --email={{item.email}} {{docker_registry_host}}:{{docker_registry_port}}/ && docker logout
    with_items: users
    register: test_docker_registry_login
